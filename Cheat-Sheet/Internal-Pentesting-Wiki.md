# :man_firefighter: Internal Pentesting Wiki :book:

## *Here you will find ways to make your work easier when doing an internal pentest.* :santa:

#### First when doing a pentest, you will start with **reconnaissance - phase** here you get to scout the network.

## Tools for scouting :detective: the network :-
**************************************
### 1.Nmap (Active Network Scanner)
**************************************
  > **Scan a subnet:**
  > - nmap ***192.168.1.0/24***
  > 
  > **Scan a host:**
  > - nmap ***www.testhostname.com***
  > 
  > **Scan a range or IPs:**
  > - nmap ***192.168.1.1-20***
  > 
  > **Nmap Port Scan types:**
  > -
  > **Scan using TCP connect:**
  > - nmap -sT ***address***
  > 
  > **Scan using TCP SYN scan (default):**
  > - nmap -sS ***address***
  > 
  > **Scan using UDP connect:**
  > - nmap -sU ***address***
  > 
  > **Service and OS Detection:**
  > -
  > **Detect OS and Services:**
  > - nmap -A ***address***
  > 
  > **Standard service detection:**
  >  
  > - nmap -sV ***address***
  > 
  > **More aggressive service detection:**
  > - nmap -sV --version-intensity 5 ***address***
  > 
  > **Light banner grabbing detection:**
  > - nmap -sV --version-intensity 0 ***address***
  > 
  > **Nmap Output Formats:**
  > -
  > **Save default output to file:**
  > - nmap -oN **outputfile.txt** *address*
  > 
  > **Save results as XML:**
  > - nmap -oX **outputfile.xmls** *address*
  > 
  > **Save in all formats:**
  > - nmap -oA **outputfile** *address*
  > 
  > **Digging deeper with NSE scripts**
  > -
  > **Get help for a script:**
  > - nmap ***- -script-help=ssl-hertbleed***
  > 
  > **Scan using default safe scripts:**
  > - nmap -sV **-sC** *address*
  > 
  > **Scan using a specific NSE script:**
  > - nmap -sV -p 443 **-script=ssl-hertbleed.nse** *address*
  > 
  > **Scan with a set of scripts:**
  > - nmap -sV **- -script=smb*** *address*
  > 
  >> **Best Nmap scan to use:**
  >> -
  >> **Aggressive Scan:**
  >> - nmap -v -sV -A -sS -T4 target -oX output.xml
  >> 
  >> **Slow scan to avoid IDS:**
  >> - nmap -v -sV -A -sS T1 target -oX output.xml
  >> 
  >> **Show open ports only:**
  >> - nmap -v -sV -A -sS --open T1 target
  >> 
  >> **Scan using vulners script which will show cve details for any outdated or vulnerable service:**
  >> - nmap -sS -sV --script vulners target
  >> 
  >> **Using [vulscan](https://github.com/scipag/vulscan), advantage of this script is that it contains more cve databases and one can specify to use one database too:**
  >> - nmap -sS --script vulscan -sV target
  >> 
  >> **Using one database:**
  >> - nmap -sS --script vulscan --script-args vulscandb=dbname.csv -sV target
  >> 
  >> **Using both scripts(vulners and vulnscan):**
  >> - nmap -sS --script vulners,vulscan -sV target
  >> 
  **Youtube Video Tutorial :wink::**
[![](http://img.youtube.com/vi/Y5TCm5mJbl0/0.jpg)](http://www.youtube.com/watch?v=Y5TCm5mJbl0 "Nmap vulners and vulscan scripts")

**************
### ![resource](https://img.icons8.com/offices/30/000000/e-learning.png) Resources
**************
- More information or cheat Sheets:
    - HighOn.Coffee [Nmap Cheat Sheet](https://highon.coffee/blog/nmap-cheat-sheet/).
    - Securesolutions.no [Nmap oresent scans](https://www.securesolutions.no/zenmap-preset-scans/?source=post_page-----868a7bd7f692----------------------).
    - Networksecurityknoledge [Nmap:commands](https://networksecurityknowledge2016.blogspot.com/2016/12/nmap-commands.html?source=post_page-----868a7bd7f692----------------------)
    - comparitech.com [Nmap Cheat Sheet with Nessus CLI cheat Sheet](https://www.comparitech.com/net-admin/nmap-nessus-cheat-sheet/)
    - Vulners.com [Complete Vulnerability Database and Security Scanner](https://vulners.com/landing)
    - Vulscan Github Repo [Vulnerability Scanning with Nmap](https://github.com/scipag/vulscan)

*****************
### 2.Wireshark, Tshark and TCPdump
**Note:** The filters work the same within all three, the only thing you will be required to do is edit afew things to what you want. The benefit with ***tshark*** and ***tcpdump*** over **wireshark** is they are command line based which is good if you are doing this on a non-graphical operating system. **But I LOVE :heart_eyes_cat: wireshark so deal with it.:cowboy_hat_face:**
*****************
> **Filter by IP address: displays all traffic from IP, be it source (src) or destination (dst):**
> - ip.addr == *address*
> 
> **Filter by source address: displays traffic only from IP source (src):**
> - ip.src == *address*
> 
> **Filter by destination: displays traffic only from IP destination (dst):**
> - ip.dst == *address*
> 
> **Filter by IP subnet: display traffic from subnet, be it source or destination:**
> - ip.addr == *address-subnet*
> 
> **Filter by protocol.**
> - Filter by protocol name:
>   - dns
>   - http
>   - ftp
>   - arp
>   - ssh
>   - telnet
>   - icmp
> 
> **Exclude IP address: remove traffic from and to IP address:**
> - !ip.addr == *address*
> 
> **Display traffic between two specific workstations**
> - ip.addr == *address1* && ip.addr == *address2*
> 
> **Filter all http get requests and responses:**
> - http.request || http.response
> 
> **Filter files by type:**
> - frame contains "(attachment|tar|exe|zip|pdf)"
> 
> **Filter traffic based on keyword:**
> - tcp contains *keyword* || frame contains *keyword*
>
>**Less used:**
> -
> **Filter by MAC:**
> - eth.addr = *mac-address*
> 
> **Filter TCP port:**
> - tcp.port == *port-number*
> 
> **Filter TCP port source (src):**
> - tcp.srcport == *port-number*
> 
> **Filter TCP port destination (dst):**
> - tcp.dstport == *port-number*
> 
> **Note:** If you want to filter for udp port edit the tcp port filters to udp.
> 
> **Find user agents:**
> - http.user_agent contains Firefox
> - !http.user_agent contains || !http.user_agent contains Chrome
> 
> **Filter three way handshake:**
> - tcp.flags.syn==1 or (tcp.seq==1 and tcp.ack==1 and tcp.len==0 and tcp.analysis.initial_rtt)
> 
> **Detecting SYN Floods:**
> - tcp.flags.syn == 1 and tcp.flags.ack == 0
> 
>> **Best Wireshark, tcpdump or tshark filters to use:**
>> -
>> **Remove your traffic, from wireshark stream and sniff for passwords on http ***unencrypted*** traffic:**
>> - !=ip.addr == *your-address* && http && http.request.method == "POST" || http.request.method == "GET" && frame contains password || tcp contains password
>>
>> **Sniff for ftp creds using tcpdump:**
>> - tcpdump -A port ftp -i *interface-name* > ftp-sniff.out **then** cat dump.out | grep PASS
>> 
>> **HTTP Analysis with Tshark:**
>> - tshark -i *interface-name* -Y http.request -T fields -e http.post -e http.get -e http.user_agent | grep password
>> 
>> **Best way to extract files from a PCAP file:**
>> - [NetworkMiner](https://www.netresec.com/index.ashx?page=NetworkMiner) is the best for this in my case, because it reconstructs the image allowing you to viewing it :smile:.
>> 
>> **Sniff passwords using tcpdump and egrep**
>> - tcpdump port http or port ftp or port smtp or port imap or port pop3 -l -A | egrep -i 'pass=|pwd=|log=|login=|user=|username=|pw=|passw=|passwd=|password=|pass:|user:|username:|password:|login:|pass |user ' --color=auto --line-buffered -B20

**************
### ![resource](https://img.icons8.com/offices/30/000000/e-learning.png) Resources
**************
- More information or cheat Sheets:
    - SANS BLUE [wiki.sans.blue TShark pdf](https://wiki.sans.blue/Tools/pdfs/tshark.pdf).
    - Peerlyst [How to extract files from a pcap file](https://www.peerlyst.com/posts/how-to-extract-images-and-other-files-from-a-pcap-file-peerlyst).
    - Hackertarget.com [tshark tutorial and filter examples](https://hackertarget.com/tshark-tutorial-and-filter-examples/)
    - Binarytides.com [Tcpdump tutorial](https://www.binarytides.com/tcpdump-tutorial-sniffing-analysing-packets/)
    - Comparitech.com [Wireshark Cheat Sheet](https://www.comparitech.com/net-admin/wireshark-cheat-sheet/)
    - Miguel Sampaio da Veiga [My Wireshark Display Filters Cheat Sheet](https://medium.com/hacker-toolbelt/wireshark-filters-cheat-sheet-eacdc438969c)
     
### 3. Bettercap an Advance Network Monitoring & MITM Attack tool 

> **Local network monitoring:**
> - net.show
>
> **Actively monitor for new host:**
> - net.prob on
> 
> **Clear interactive screen output:**
> - clear
> 
> **Increase ticker period (default is 1sec):**
> - set ticker.period 3
> 
> **Execute given set of commands periodically:**
> - ticker on
> 
> **ARP spoofing entire subnet:**
> - arp.spoof on
> 
> **To reduce level of verbality:**
> - set net.sniff.verbose false
> 
> **Run sniffer:**
> - net.sniff on
> 
> **Enable transparent HTTP proxy:**
> - http.proxy on
> 
> **Enable SSL stripping:**
> - set http.proxy.sslstrip true
> 
> **Password Sniffing:**
> - set net.sniff.regexp .*password=.+
> 
> **Save sniffed packets to a pcap file:**
> - set net.sniff.output file-name.cap
> 
> **Bind bettercap when starting it on a specific network interface, if you have two or three network interfaces.**
> - bettercap -iface ***network-interface-name***
 

### 4. Check for any leaked passwords of any specific domain name or for a specific email addess.
So checking for any passwords leak on the go is usually also important. I found one tool that does that.
The tool is known as [pwndb](https://github.com/davidtavarez/pwndb)

> **Using a single Email:**
> - python pwndb.py --target target@email.com
>
> **Using a domain name:**
> - python pwndb.py --target @target-domain.com
>
> **Using a list in a file:**
> - python pwndb.py --list targets.txt
>
> **Using % to to look for a target leaked creds in different domains:**
>
> This is used when lets say the target is gr00t but has multiple email accounts (google, yahoo etc) to see if we have any leaked creds.
> - python pwndb.py --target target.%

**************
### ![resource](https://img.icons8.com/offices/30/000000/e-learning.png) Resources
**************
- More information on pwndb:
    - David Tavarez [How to use pwndb.py](https://davidtavarez.github.io/2019/tutorial-pwndb-command-line-tool-python/).

:smile: :clown:
